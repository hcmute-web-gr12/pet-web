"use strict";var r=(e,t,n)=>new Promise((s,o)=>{var c=d=>{try{i(n.next(d))}catch(E){o(E)}},a=d=>{try{i(n.throw(d))}catch(E){o(E)}},i=d=>d.done?s(d.value):Promise.resolve(d.value).then(c,a);i((n=n.apply(e,t)).next())});var y=e=>{let t=s=>{s.stopPropagation(),s.stopImmediatePropagation(),s.preventDefault()};e.addEventListener("click",t,{capture:!0});let n=e.style.pointerEvents;return e.style.pointerEvents="none",()=>{e.removeEventListener("click",t,{capture:!0}),e.style.pointerEvents=n}};var u=(...e)=>{let t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),s=document.createElementNS(t,"circle"),o=document.createElementNS(t,"path");return n.classList.add("animate-spin","text-stone-100",...e),n.setAttribute("fill","none"),n.setAttribute("viewBox","0 0 24 24"),s.classList.add("opacity-25"),s.setAttribute("cx","12"),s.setAttribute("cy","12"),s.setAttribute("r","10"),s.setAttribute("stroke","currentColor"),s.setAttribute("stroke-width","4"),o.classList.add("opacity-75"),o.setAttribute("d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),o.setAttribute("fill","currentColor"),n.append(s,o),n};var f=(e,...t)=>{let n=u(...t);return e.prepend(n),console.log(n,e),()=>{n.remove()}};var h=!1,l={counter:0,shouldUpdate:!1},m={index:-1,editing:!1};function x(e){return r(this,null,function*(){if(e.preventDefault(),h)return;h=!0;let t=document.getElementById("pet-dialog");if(t instanceof HTMLDialogElement){let n=document.getElementById("pet-add-submit"),s=f(n,"w-4","h-4","mr-2"),o=yield fetch(this.action,{method:"post",body:new FormData(this)});if(s(),h=!1,o.status===200){p(),t.close();return}let c=document.getElementById("pet-form-error");c&&(c.textContent=yield o.text())}})}function S(){let e=document.getElementById("pet-dialog");e instanceof HTMLDialogElement&&e.showModal()}function C(){let e=document.getElementById("pet-dialog");e instanceof HTMLDialogElement&&e.close()}function p(e){return r(this,null,function*(){var c,a;let t=document.getElementById("pet-table");if(!(t instanceof HTMLTableElement))return;let n=y(t);t.classList.add("animate-pulse");let s=e?yield fetch(`/api/admin/pet?${e.toString()}`).then(i=>i.text()):yield fetch("/api/admin/pet").then(i=>i.text());n(),(c=t.querySelector("tbody"))==null||c.remove(),(a=t.querySelector("tfoot"))==null||a.remove(),t.insertAdjacentHTML("beforeend",s),w();let o=document.getElementById("pet-select-all");o&&(o.checked=!1),setTimeout(()=>{t.classList.remove("animate-pulse")},100)})}function L(...e){return`/api/admin/pet?${e.map(t=>`index=${t}`).join("&")}`}function A(){return r(this,null,function*(){let e=this.id.replace("pet-delete-",""),t=this.cloneNode();t.append(u("w-5","h-5")),this.replaceWith(t),++l.counter;let n=(yield fetch(L(+e),{method:"delete"})).status;if(--l.counter,t.replaceWith(this),t.remove(),n===200){if(this.disabled=!0,l.shouldUpdate=!0,l.counter)return;l.shouldUpdate&&(l.shouldUpdate=!1,p())}})}function w(){for(let e of document.getElementsByClassName("pet-edit")||[])e.addEventListener("click",U);for(let e of document.getElementsByClassName("pet-delete")||[])e.addEventListener("click",A);for(let e of document.getElementsByClassName("pet-select")||[])e.addEventListener("input",N);for(let e of document.getElementsByClassName("page-link")||[])e.addEventListener("click",g);document.getElementById("page-previous").addEventListener("click",g),document.getElementById("page-next").addEventListener("click",g)}function D(){for(let e of document.getElementsByClassName("pet-select"))e.checked=this.checked}function N(){let e=document.getElementById("pet-select-all");e&&e.checked&&(this.checked||(e.checked=!1))}function P(){return r(this,null,function*(){let e=[],t=[];for(let[a,i]of Array.from(document.getElementsByClassName("pet-select")).entries())i.checked&&(t.push(document.getElementById(`pet-delete-${a}`)),e.push(a));if(!e.length)return;let n=L(...e),s=[],o=fetch(n,{method:"delete"});t.push(this);for(let a of t){let i=a.cloneNode();s.push(i),i.append(u("w-5","h-5")),a.replaceWith(i)}++l.counter;let c=(yield o).status;--l.counter;for(let[a,i]of t.entries())s[a].replaceWith(i),s[a].remove();if(c===200){if(l.shouldUpdate=!0,l.counter)return;l.shouldUpdate&&(l.shouldUpdate=!1,p())}})}function U(){return r(this,null,function*(){if(m.editing)return;let e=document.getElementById("pet-edit-dialog");if(!e)return;m.index=+this.id.replace("pet-edit-","");let t=this.cloneNode();m.editing=!0,t.appendChild(u("w-5","h-5")),this.replaceWith(t);let n=yield fetch(L(m.index));if(t.replaceWith(this),t.remove(),n.status===200){let s=yield n.json();if(s){let o=document.getElementById("pet-edit-name"),c=document.getElementById("pet-edit-price"),a=document.getElementById("pet-edit-stock"),i=document.getElementById("pet-edit-image"),d=document.getElementById("pet-edit-description");o&&(o.value=s.name),c&&(c.value=s.price),a&&(a.value=s.stock),i&&(i.src=s.imagePublicId),d&&(d.value=s.description),e.showModal();return}}m.editing=!1})}function W(e){return r(this,null,function*(){e.preventDefault();let t=new FormData(this);t.set("index",m.index+"");let n=f(document.getElementById("pet-edit-submit"),"w-4","h-4","mr-2"),s=yield fetch("/api/admin/pet",{method:"put",body:t});if(n(),s.status===200){p(),document.getElementById("pet-edit-dialog").close();return}document.getElementById("pet-edit-error").textContent=yield s.text()})}function R(){m.editing=!1}function g(e){return r(this,null,function*(){e.preventDefault();let t=new URL(window.location.href),n=Number(t.searchParams.get("page"))||1;if(this.id==="page-previous"){if(--n<1)return}else if(this.id==="page-next")++n;else if(console.log(this.href,new URL(this.href)),n=Number(new URL(this.href).searchParams.get("page")),isNaN(n))return;t.searchParams.set("page",n+""),yield p(t.searchParams),window.history.pushState({},"",t)})}var b;(b=document.getElementById("pet-form"))==null||b.addEventListener("submit",x);var B;(B=document.getElementById("pet-add"))==null||B.addEventListener("pointerdown",S);var v;(v=document.getElementById("pet-form-back"))==null||v.addEventListener("pointerdown",C);var T;(T=document.getElementById("pet-select-all"))==null||T.addEventListener("input",D);var M;(M=document.getElementById("pet-delete-some"))==null||M.addEventListener("click",P);var H;(H=document.getElementById("pet-edit-dialog"))==null||H.addEventListener("close",R);var I;(I=document.getElementById("pet-edit-form"))==null||I.addEventListener("submit",W);var k;(k=document.getElementById("pet-edit-back"))==null||k.addEventListener("click",()=>{document.getElementById("pet-edit-dialog").close()});w();
