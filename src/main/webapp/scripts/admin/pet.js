"use strict";var r=(e,t,o)=>new Promise((n,s)=>{var d=c=>{try{a(o.next(c))}catch(E){s(E)}},i=c=>{try{a(o.throw(c))}catch(E){s(E)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(d,i);a((o=o.apply(e,t)).next())});var L=e=>{let t=n=>{n.stopPropagation(),n.stopImmediatePropagation(),n.preventDefault()};e.addEventListener("click",t,{capture:!0});let o=e.style.pointerEvents;return e.style.pointerEvents="none",()=>{e.removeEventListener("click",t,{capture:!0}),e.style.pointerEvents=o}};var u=(...e)=>{let t="http://www.w3.org/2000/svg",o=document.createElementNS(t,"svg"),n=document.createElementNS(t,"circle"),s=document.createElementNS(t,"path");return o.classList.add("animate-spin","text-stone-100",...e),o.setAttribute("fill","none"),o.setAttribute("viewBox","0 0 24 24"),n.classList.add("opacity-25"),n.setAttribute("cx","12"),n.setAttribute("cy","12"),n.setAttribute("r","10"),n.setAttribute("stroke","currentColor"),n.setAttribute("stroke-width","4"),s.classList.add("opacity-75"),s.setAttribute("d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),s.setAttribute("fill","currentColor"),o.append(n,s),o};var f=(e,...t)=>{let o=u(...t);return e.prepend(o),console.log(o,e),()=>{o.remove()}};var h=!1,l={counter:0,shouldUpdate:!1},m={index:-1,editing:!1};function S(e){return r(this,null,function*(){if(e.preventDefault(),h)return;h=!0;let t=document.getElementById("pet-dialog");if(t instanceof HTMLDialogElement){let o=document.getElementById("pet-add-submit"),n=f(o,"w-4","h-4","mr-2"),s=yield fetch(this.action,{method:"post",body:new FormData(this)});if(n(),h=!1,s.status===200){p(),t.close();return}let d=document.getElementById("pet-form-error");d&&(d.textContent=yield s.text())}})}function C(){let e=document.getElementById("pet-dialog");e instanceof HTMLDialogElement&&e.showModal()}function A(){let e=document.getElementById("pet-dialog");e instanceof HTMLDialogElement&&e.close()}function p(){return r(this,null,function*(){var s,d;let e=document.getElementById("pet-table");if(!(e instanceof HTMLTableElement))return;let t=L(e);e.classList.add("animate-pulse");let o=yield fetch("/api/admin/pet").then(i=>i.text());t(),(s=e.querySelector("tbody"))==null||s.remove(),(d=e.querySelector("tfoot"))==null||d.remove(),e.insertAdjacentHTML("beforeend",o),w();let n=document.getElementById("pet-select-all");n&&(n.checked=!1),setTimeout(()=>{e.classList.remove("animate-pulse")},100)})}function g(...e){return`/api/admin/pet?${e.map(t=>`index=${t}`).join("&")}`}function D(){return r(this,null,function*(){let e=this.id.replace("pet-delete-",""),t=this.cloneNode();t.append(u("w-5","h-5")),this.replaceWith(t),++l.counter;let o=(yield fetch(g(+e),{method:"delete"})).status;if(--l.counter,t.replaceWith(this),t.remove(),o===200){if(this.disabled=!0,l.shouldUpdate=!0,l.counter)return;l.shouldUpdate&&(l.shouldUpdate=!1,p())}})}function w(){for(let e of document.getElementsByClassName("pet-edit")||[])e.addEventListener("click",U);for(let e of document.getElementsByClassName("pet-delete")||[])e.addEventListener("click",D);for(let e of document.getElementsByClassName("pet-select")||[])e.addEventListener("input",N)}function x(){for(let e of document.getElementsByClassName("pet-select"))e.checked=this.checked}function N(){let e=document.getElementById("pet-select-all");e&&e.checked&&(this.checked||(e.checked=!1))}function P(){return r(this,null,function*(){let e=[],t=[];for(let[i,a]of Array.from(document.getElementsByClassName("pet-select")).entries())a.checked&&(t.push(document.getElementById(`pet-delete-${i}`)),e.push(i));if(!e.length)return;let o=g(...e),n=[],s=fetch(o,{method:"delete"});t.push(this);for(let i of t){let a=i.cloneNode();n.push(a),a.append(u("w-5","h-5")),i.replaceWith(a)}++l.counter;let d=(yield s).status;--l.counter;for(let[i,a]of t.entries())n[i].replaceWith(a),n[i].remove();if(d===200){if(l.shouldUpdate=!0,l.counter)return;l.shouldUpdate&&(l.shouldUpdate=!1,p())}})}function U(){return r(this,null,function*(){if(m.editing)return;let e=document.getElementById("pet-edit-dialog");if(!e)return;m.index=+this.id.replace("pet-edit-","");let t=this.cloneNode();m.editing=!0,t.appendChild(u("w-5","h-5")),this.replaceWith(t);let o=yield fetch(g(m.index));if(t.replaceWith(this),t.remove(),o.status===200){let n=yield o.json();if(n){let s=document.getElementById("pet-edit-name"),d=document.getElementById("pet-edit-price"),i=document.getElementById("pet-edit-stock"),a=document.getElementById("pet-edit-image"),c=document.getElementById("pet-edit-description");s&&(s.value=n.name),d&&(d.value=n.price),i&&(i.value=n.stock),a&&(a.src=n.imagePublicId),c&&(c.value=n.description),e.showModal();return}}m.editing=!1})}function W(e){return r(this,null,function*(){e.preventDefault();let t=new FormData(this);t.set("index",m.index+"");let o=f(document.getElementById("pet-edit-submit"),"w-4","h-4","mr-2"),n=yield fetch("/api/admin/pet",{method:"put",body:t});if(o(),n.status===200){p(),document.getElementById("pet-edit-dialog").close();return}document.getElementById("pet-edit-error").textContent=yield n.text()})}function j(){m.editing=!1}var y;(y=document.getElementById("pet-form"))==null||y.addEventListener("submit",S);var b;(b=document.getElementById("pet-add"))==null||b.addEventListener("pointerdown",C);var B;(B=document.getElementById("pet-form-back"))==null||B.addEventListener("pointerdown",A);var T;(T=document.getElementById("pet-select-all"))==null||T.addEventListener("input",x);var M;(M=document.getElementById("pet-select-all"))==null||M.addEventListener("input",x);var H;(H=document.getElementById("pet-delete-some"))==null||H.addEventListener("click",P);var v;(v=document.getElementById("pet-edit-dialog"))==null||v.addEventListener("close",j);var I;(I=document.getElementById("pet-edit-form"))==null||I.addEventListener("submit",W);var k;(k=document.getElementById("pet-edit-back"))==null||k.addEventListener("click",()=>{document.getElementById("pet-edit-dialog").close()});w();
