"use strict";var g=e=>{let t=s=>{s.stopPropagation(),s.stopImmediatePropagation(),s.preventDefault()};e.addEventListener("click",t,{capture:!0});let n=e.style.pointerEvents;return e.style.pointerEvents="none",()=>{e.removeEventListener("click",t,{capture:!0}),e.style.pointerEvents=n}};var m=(...e)=>{let t="http://www.w3.org/2000/svg",n=document.createElementNS(t,"svg"),s=document.createElementNS(t,"circle"),o=document.createElementNS(t,"path");return n.classList.add("animate-spin","text-stone-100",...e),n.setAttribute("fill","none"),n.setAttribute("viewBox","0 0 24 24"),s.classList.add("opacity-25"),s.setAttribute("cx","12"),s.setAttribute("cy","12"),s.setAttribute("r","10"),s.setAttribute("stroke","currentColor"),s.setAttribute("stroke-width","4"),o.classList.add("opacity-75"),o.setAttribute("d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"),o.setAttribute("fill","currentColor"),n.append(s,o),n};var p=(e,...t)=>{let n=m(...t);return e.prepend(n),console.log(n,e),()=>{n.remove()}};var E=!1,c={counter:0,shouldUpdate:!1},d={index:-1,editing:!1};async function k(e){if(e.preventDefault(),E)return;E=!0;let t=document.getElementById("pet-dialog");if(t instanceof HTMLDialogElement){let n=document.getElementById("pet-add-submit"),s=p(n,"w-4","h-4","mr-2"),o=await fetch(this.action,{method:"post",body:new FormData(this)});if(s(),E=!1,o.status===200){u(),t.close();return}let l=document.getElementById("pet-form-error");l&&(l.textContent=await o.text())}}function w(){let e=document.getElementById("pet-dialog");e instanceof HTMLDialogElement&&e.showModal()}function x(){let e=document.getElementById("pet-dialog");e instanceof HTMLDialogElement&&e.close()}async function u(e){var a,i;let t=document.getElementById("pet-table");if(!(t instanceof HTMLTableElement))return;let n=e?e.toString():new URLSearchParams(window.location.search).toString(),s=g(t);t.classList.add("animate-pulse");let o=n?await fetch(`/api/admin/pet?${n}`).then(r=>r.text()):await fetch("/api/admin/pet").then(r=>r.text());s(),(a=t.querySelector("tbody"))==null||a.remove(),(i=t.querySelector("tfoot"))==null||i.remove(),t.insertAdjacentHTML("beforeend",o),I();let l=document.getElementById("pet-select-all");l&&(l.checked=!1),setTimeout(()=>{t.classList.remove("animate-pulse")},100)}function h(...e){return`/api/admin/pet?${e.map(t=>`index=${t}`).join("&")}`}async function S(){let e=this.id.replace("pet-delete-",""),t=this.cloneNode();t.append(m("w-5","h-5")),this.replaceWith(t),++c.counter;let n=(await fetch(h(+e),{method:"delete"})).status;if(--c.counter,t.replaceWith(this),t.remove(),n===200){if(this.disabled=!0,c.shouldUpdate=!0,c.counter)return;c.shouldUpdate&&(c.shouldUpdate=!1,u())}}function I(){for(let e of document.getElementsByClassName("pet-edit")||[])e.addEventListener("click",A);for(let e of document.getElementsByClassName("pet-delete")||[])e.addEventListener("click",S);for(let e of document.getElementsByClassName("pet-select")||[])e.addEventListener("input",N);for(let e of document.getElementsByClassName("page-link")||[])e.addEventListener("click",f);for(let e of document.getElementsByClassName("page-next")||[])e.addEventListener("click",f);for(let e of document.getElementsByClassName("page-previous")||[])e.addEventListener("click",f)}function C(){for(let e of document.getElementsByClassName("pet-select"))e.checked=this.checked}function N(){let e=document.getElementById("pet-select-all");e&&e.checked&&(this.checked||(e.checked=!1))}async function P(){let e=[],t=[];for(let[a,i]of Array.from(document.getElementsByClassName("pet-select")).entries())i.checked&&(t.push(document.getElementById(`pet-delete-${a}`)),e.push(a));if(!e.length)return;let n=h(...e),s=[],o=fetch(n,{method:"delete"});t.push(this);for(let a of t){let i=a.cloneNode();s.push(i),i.append(m("w-5","h-5")),a.replaceWith(i)}++c.counter;let l=(await o).status;--c.counter;for(let[a,i]of t.entries())s[a].replaceWith(i),s[a].remove();if(l===200){if(c.shouldUpdate=!0,c.counter)return;c.shouldUpdate&&(c.shouldUpdate=!1,u())}}async function A(){if(d.editing)return;let e=document.getElementById("pet-edit-dialog");if(!e)return;d.index=+this.id.replace("pet-edit-","");let t=this.cloneNode();d.editing=!0,t.appendChild(m("w-5","h-5")),this.replaceWith(t);let n=await fetch(h(d.index));if(t.replaceWith(this),t.remove(),n.status===200){let s=await n.json();if(s){let o=document.getElementById("pet-edit-name"),l=document.getElementById("pet-edit-price"),a=document.getElementById("pet-edit-stock"),i=document.getElementById("pet-edit-image"),r=document.getElementById("pet-edit-description");o&&(o.value=s.name),l&&(l.value=s.price),a&&(a.value=s.stock),i&&(i.src=s.imagePublicId),r&&(r.value=s.description),e.showModal();return}}d.editing=!1}async function D(e){e.preventDefault();let t=new FormData(this);t.set("index",d.index+"");let n=p(document.getElementById("pet-edit-submit"),"w-4","h-4","mr-2"),s=await fetch("/api/admin/pet",{method:"put",body:t});if(n(),document.getElementById("pet-edit-form").reset(),s.status===200){u(),document.getElementById("pet-edit-dialog").close();return}document.getElementById("pet-edit-error").textContent=await s.text()}function U(){d.editing=!1}async function f(e){e.preventDefault();let t=new URL(window.location.href),n=Number(t.searchParams.get("page"))||1;if(this.classList.contains("page-previous")){if(--n<1)return}else if(this.classList.contains("page-next"))++n;else if(n=Number(new URL(this.href).searchParams.get("page")),isNaN(n))return;t.searchParams.set("page",n+""),await u(t.searchParams),window.history.pushState({},"",t)}var L;(L=document.getElementById("pet-form"))==null||L.addEventListener("submit",k);var y;(y=document.getElementById("pet-add"))==null||y.addEventListener("pointerdown",w);var T;(T=document.getElementById("pet-form-back"))==null||T.addEventListener("pointerdown",x);var B;(B=document.getElementById("pet-select-all"))==null||B.addEventListener("input",C);var M;(M=document.getElementById("pet-delete-some"))==null||M.addEventListener("click",P);var b;(b=document.getElementById("pet-edit-dialog"))==null||b.addEventListener("close",U);var H;(H=document.getElementById("pet-edit-form"))==null||H.addEventListener("submit",D);var v;(v=document.getElementById("pet-edit-back"))==null||v.addEventListener("click",()=>{document.getElementById("pet-edit-dialog").close()});I();
